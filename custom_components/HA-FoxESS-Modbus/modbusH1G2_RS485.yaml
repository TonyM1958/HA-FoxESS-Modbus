---
# ---------------------------------------------------------------------------
# START: modbus include file for HA-FoxESS-Modbus RS485 connection
# ---------------------------------------------------------------------------
# Supports RS-485 to USB, RS485 to Wifi/LAN for KH inverters
# Version: 1.4.6
# Date:    18/03/02024

- name: FoxESSInverterModbus

  # ------------------------ USB connection  -------------------------------
  # Enter your port in secrets.yaml
  type: serial
  port: !secret foxess_inv1_tty
  baudrate: 9600
  bytesize: 8
  method: rtu
  parity: N
  stopbits: 1

  # ----------------------- LAN connection --------------------------------
  # Enter your IP address in secrets.yaml
  # Comment out the previous section and uncomment this section to use
  #type: tcp
  #host: !secret foxess_inv1_ip_address
  #port: 502
  # ---------------------------------------------------------------------------

  # ---------------------------------------------------------------------------
  # List of modbus addresses to read.
  # ---------------------------------------------------------------------------

  sensors:
    # -------------------------------------------------------------------------
    # Device
    # -------------------------------------------------------------------------
    - name: "Inverter Model"
      unique_id: foxess_inv1_inverter_model
      address: 30000
      slave: !secret foxess_inv1_slave
      count: 16
      data_type: string
      scan_interval: !secret scan_interval_static
    - name: "Inverter Serial No"
      unique_id: foxess_inv1_inverter_serial_no
      address: 30016
      slave: !secret foxess_inv1_slave
      count: 16
      data_type: string
      scan_interval: !secret scan_interval_static

    # -------------------------------------------------------------------------
    # Inverter operation
    # -------------------------------------------------------------------------

    - name: "RVolt"
      unique_id: foxess_inv1_grid_voltage_r
      address: 31006
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: voltage
      unit_of_measurement: "V"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "RCurrent"
      unique_id: foxess_inv1_inv_current_r
      address: 31007
      slave: !secret foxess_inv1_slave
      device_class: current
      unit_of_measurement: "A"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "RPower"
      unique_id: foxess_inv1_inv_power_r
      address: 31008
      slave: !secret foxess_inv1_slave
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high
    - name: "Grid Frequency"
      unique_id: foxess_inv1_grid_frequency
      address: 31009
      slave: !secret foxess_inv1_slave
      data_type: uint16
      unit_of_measurement: "Hz"
      device_class: frequency
      scale: 0.01
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "EPS RVolt"
      unique_id: foxess_inv1_eps_voltage_r
      address: 31010
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: voltage
      unit_of_measurement: "V"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "EPS RCurrent"
      unique_id: foxess_inv1_eps_current_r
      address: 31011
      input_type: input
      slave: !secret foxess_inv1_slave
      device_class: current
      unit_of_measurement: "A"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "EPS RPower"
      unique_id: foxess_inv1_eps_power_r
      address: 31012
      input_type: input
      slave: !secret foxess_inv1_slave
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high
    - name: "EPS Frequency"
      unique_id: foxess_inv1_eps_frequency
      address: 31013
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: frequency
      unit_of_measurement: "Hz"
      scale: 0.01
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Grid CT"
      unique_id: foxess_inv1_grid_ct
      address: 31014
      slave: !secret foxess_inv1_slave
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high
    - name: "CT2"
      unique_id: foxess_inv1_ct2
      address: 31015
      slave: !secret foxess_inv1_slave
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high
    - name: "Load Power CT1"
      unique_id: foxess_inv1_load_power_ct1
      address: 31016
      slave: !secret foxess_inv1_slave
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high
    - name: "Inverter Temperature"
      unique_id: foxess_inv1_inverter_temperature
      address: 31018
      slave: !secret foxess_inv1_slave
      device_class: temperature
      unit_of_measurement: "°C"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Inner Temperature"
      unique_id: foxess_inv1_ambient_temperature
      address: 31019
      slave: !secret foxess_inv1_slave
      device_class: temperature
      unit_of_measurement: "°C"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "InvBatVolt"
      unique_id: foxess_inv1_battery_voltage
      address: 31020
      slave: !secret foxess_inv1_slave
      device_class: voltage
      unit_of_measurement: "V"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "InvBatCurrent"
      unique_id: foxess_inv1_battery_current
      address: 31021
      slave: !secret foxess_inv1_slave
      device_class: current
      unit_of_measurement: "A"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "Battery Power"
      unique_id: foxess_inv1_battery_power
      address: 31022
      slave: !secret foxess_inv1_slave
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high
    - name: "Battery SoC"
      unique_id: foxess_inv1_battery_soc
      address: 31024
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: battery
      unit_of_measurement: "%"
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "BMS Max Charge Current"
      unique_id: foxess_inv1_bms_charge_rate
      address: 31025
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: current
      unit_of_measurement: "A"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "BMS Max Discharge Current"
      unique_id: foxess_inv1_bms_discharge_rate
      address: 31026
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: current
      unit_of_measurement: "A"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "BMS Status Code"
      unique_id: foxess_inv1_battery_status_code
      address: 31028
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "BMS Connection Code"
      unique_id: foxess_inv1_bms_connection_code
      address: 31029
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_low

    # -------------------------------------------------------------------------
    # Inverter energy meters
    # -------------------------------------------------------------------------

    - name: "PV Energy Total"
      unique_id: foxess_inv1_pv_energy_total
      address: 32000
      slave: !secret foxess_inv1_slave
      data_type: uint32
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "PV Energy Today"
      unique_id: foxess_inv1_pv_energy_today
      address: 32002
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Charge Energy Total"
      unique_id: foxess_inv1_charge_energy_total
      address: 32003
      slave: !secret foxess_inv1_slave
      data_type: uint32
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Charge Energy Today"
      unique_id: foxess_inv1_charge_energy_today
      address: 32005
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Discharge Energy Total"
      unique_id: foxess_inv1_discharge_energy_total
      address: 32006
      slave: !secret foxess_inv1_slave
      data_type: uint32
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Discharge Energy Today"
      unique_id: foxess_inv1_discharge_energy_today
      address: 32008
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Feed In Energy Total"
      unique_id: foxess_inv1_feed_in_energy_total
      address: 32009
      slave: !secret foxess_inv1_slave
      data_type: uint32
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Feed In Energy Today"
      unique_id: foxess_inv1_feed_in_energy_today
      address: 32011
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Grid Consumption Energy Total"
      unique_id: foxess_inv1_grid_consumption_energy_total
      address: 32012
      slave: !secret foxess_inv1_slave
      data_type: uint32
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Grid Consumption Energy Today"
      unique_id: foxess_inv1_grid_consumption_energy_today
      address: 32014
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Output Energy Total"
      unique_id: foxess_inv1_output_energy_total
      address: 32015
      slave: !secret foxess_inv1_slave
      data_type: uint32
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Output Energy Today"
      unique_id: foxess_inv1_output_energy_today
      address: 32017
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Input Energy Total" # battery force charge
      unique_id: foxess_inv1_input_energy_total
      address: 32018
      slave: !secret foxess_inv1_slave
      data_type: uint32
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Input Energy Today" # battery force charge
      unique_id: foxess_inv1_input_energy_today
      address: 32020
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Load Energy Total"
      unique_id: foxess_inv1_load_energy_total
      address: 32021
      slave: !secret foxess_inv1_slave
      data_type: uint32
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Load Energy Today"
      unique_id: foxess_inv1_load_energy_today
      address: 32023
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low

    # -------------------------------------------------------------------------
    # Firmware
    # -------------------------------------------------------------------------
    - name: "Master Version Code"
      unique_id: foxess_inv1_master_version_code
      address: 36001
      slave: !secret foxess_inv1_slave
      data_type: uint16 # hex byte encoded 0x121 = v1.21
      scan_interval: !secret scan_interval_static
    - name: "Slave Version Code"
      unique_id: foxess_inv1_slave_version_code
      address: 36002
      slave: !secret foxess_inv1_slave
      data_type: uint16 # hex byte encoded 0x102 = v1.02
      scan_interval: !secret scan_interval_static
    - name: "Manager Version Code"
      unique_id: foxess_inv1_manager_version_code
      address: 36003
      slave: !secret foxess_inv1_slave
      data_type: uint16 # hex byte encoded 0x130 = v1.30
      scan_interval: !secret scan_interval_static

    # -------------------------------------------------------------------------
    # BMS 1
    # -------------------------------------------------------------------------
    - name: "BMS 1 Master Version code"
      unique_id: foxess_inv1_bms_1_master_version_code
      address: 37003
      slave: !secret foxess_inv1_slave
      data_type: uint16 # encoding tbd
      scan_interval: !secret scan_interval_static
    - name: "BMS 1 Master Type Code"
      unique_id: foxess_inv1_bms_1_master_type_code
      address: 37004
      slave: !secret foxess_inv1_slave
      data_type: uint16 # encoding tbd
      scan_interval: !secret scan_interval_static
    - name: "BMS 1 Slave 1 Version code"
      unique_id: foxess_inv1_bms_1_slave_1_version_code
      address: 37033
      slave: !secret foxess_inv1_slave
      data_type: uint16 # encoding tbd
      state_class: measurement
      scan_interval: !secret scan_interval_static
    - name: "BMS 1 Slave 2 Version code"
      unique_id: foxess_inv1_bms_1_slave_2_version_code
      address: 37034
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_static
    - name: "BMS 1 Slave 3 Version code"
      unique_id: foxess_inv1_bms_1_slave_3_version_code
      address: 37035
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_static
    - name: "BMS 1 Slave 4 Version code"
      unique_id: foxess_inv1_bms_1_slave_4_version_code
      address: 37036
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_static
    - name: "BMS 1 Slave 5 Version code"
      unique_id: foxess_inv1_bms_1_slave_5_version_code
      address: 37037
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_static
    - name: "BMS 1 Slave 6 Version code"
      unique_id: foxess_inv1_bms_1_slave_6_version_code
      address: 37038
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_static
    - name: "BMS 1 Slave 7 Version code"
      unique_id: foxess_inv1_bms_1_slave_7_version_code
      address: 37039
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_static
    - name: "BMS 1 Slave 8 Version code"
      unique_id: foxess_inv1_bms_1_slave_8_version_code
      address: 37040
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_static
    - name: "BMS 1 Slave 9 Version code"
      unique_id: foxess_inv1_bms_1_slave_9_version_code
      address: 37041
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_static
      # etc up to 32 slaves per BMS
    - name: "BMS 1 Temperature"
      unique_id: foxess_inv1_bms_1_temperature
      address: 37611
      slave: !secret foxess_inv1_slave
      device_class: temperature
      unit_of_measurement: "°C"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "BMS 1 SoC"
      unique_id: foxess_inv1_bms_1_soc
      address: 37612
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: battery
      unit_of_measurement: "%"
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "BMS 1 SoH"
      unique_id: foxess_inv1_bms_1_soh
      address: 37624
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: battery
      unit_of_measurement: "%"
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "BMS 1 Fault 1 Code"
      unique_id: foxess_inv1_bms_1_fault_1_code
      address: 37626
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_low
    - name: "BMS 1 Fault 2 Code"
      unique_id: foxess_inv1_bms_1_fault_2_code
      address: 37627
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_low
    - name: "BMS 1 Fault 3 Code"
      unique_id: foxess_inv1_bms_1_fault_3_code
      address: 37628
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_low
    - name: "BMS 1 Fault 4 Code"
      unique_id: foxess_inv1_bms_1_fault_4_code
      address: 37629
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_low
    - name: "BMS 1 Fault 5 Code"
      unique_id: foxess_inv1_bms_1_fault_5_code
      address: 37630
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_low
    - name: "BMS 1 Fault 6 Code"
      unique_id: foxess_inv1_bms_1_fault_6_code
      address: 37631
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_low
    - name: "BMS 1 Residual Energy"
      unique_id: foxess_inv1_bms_1_residual_energy
      address: 37632
      slave: !secret foxess_inv1_slave
      input_type: input
      data_type: uint16
      device_class: energy_storage
      unit_of_measurement: "kWh"
      scale: 0.01
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_low

    # -------------------------------------------------------------------------
    # Inverter Operation Information
    # -------------------------------------------------------------------------
    - name: "Protocol Version Code"
      unique_id: foxess_inv1_protocol_version_code
      address: 39000
      slave: !secret foxess_inv1_slave
      data_type: uint32 # hex byte encoded 0x01020304 = v1.02.03.04
      scan_interval: !secret scan_interval_static
      # Omit Model Name 39002 and SN 39018, also available at 30000 and 30016
    - name: "Inverter Part No"
      unique_id: foxess_inv1_inverter_part_no
      address: 39034
      slave: !secret foxess_inv1_slave
      count: 16
      data_type: string # encoding tbd
      scan_interval: !secret scan_interval_static
    - name: "Inverter Model ID"
      unique_id: foxess_inv1_inverter_model_id
      address: 39050
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_static
    - name: "Number of Strings"
      unique_id: foxess_inv1_number_of_strings
      address: 39051
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_static
    - name: "Number of MPPT"
      unique_id: foxess_inv1_number_of_mppt
      address: 39052
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_static
    - name: "Rated Power" # Pn
      unique_id: foxess_inv1_rated_power
      address: 39053
      slave: !secret foxess_inv1_slave
      data_type: int32
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_static
    - name: "Max Active Power" # Pmax
      unique_id: foxess_inv1_max_active_power
      address: 39055
      slave: !secret foxess_inv1_slave
      data_type: int32
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_static
    - name: "Max Apparent Power" # Smax
      unique_id: foxess_inv1_max_apparent_power
      address: 39057
      slave: !secret foxess_inv1_slave
      data_type: int32
      device_class: power
      unit_of_measurement: "kVA"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_static
    - name: "Max Reactive Export" # Qmax export
      unique_id: foxess_inv1_max_reactive_export
      address: 39059
      slave: !secret foxess_inv1_slave
      data_type: int32
      device_class: power
      unit_of_measurement: "kVAR"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_static
    - name: "Max Reactive Import" # Qmax import
      unique_id: foxess_inv1_max_reactive_import
      address: 39061
      slave: !secret foxess_inv1_slave
      data_type: int32
      device_class: power
      unit_of_measurement: "kVAR"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_static
    - name: "Inverter Status 1 Code"
      unique_id: foxess_inv1_inverter_status_1_code
      address: 39063
      slave: !secret foxess_inv1_slave
      data_type: uint16 # bitfield, bit0: Standby, bit2: Operation, bit6: Fault (1)
      state_class: measurement
      scan_interval: !secret scan_interval_medium
      # reserved. 39064 Inverter Status 2 Code?
    - name: "Inverter Status 3 Code"
      unique_id: foxess_inv1_inverter_status_3_code
      address: 39065
      slave: !secret foxess_inv1_slave
      data_type: uint32 # bitfield, bit0: On-Grid/Off-grid (0/1)
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "Inverter Alarm 1 Code"
      unique_id: foxess_inv1_inverter_alarm_1_code
      address: 39067
      slave: !secret foxess_inv1_slave
      data_type: uint16 # bitfield - see Alarm code table
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Inverter Alarm 2 Code"
      unique_id: foxess_inv1_inverter_alarm_2_code
      address: 39068
      slave: !secret foxess_inv1_slave
      data_type: uint16 # bitfield - see Alarm code table
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Inverter Alarm 3 Code"
      unique_id: foxess_inv1_inverter_alarm_3_code
      address: 39069
      slave: !secret foxess_inv1_slave
      data_type: uint16 # bitfield - see Alarm code table
      state_class: measurement
      scan_interval: !secret scan_interval_low

    # -------------------------------------------------------------------------
    # Meter Info
    # -------------------------------------------------------------------------

    - name: "Meter 1 Connection Code"
      unique_id: foxess_inv1_meter_1_connection_code
      address: 38801
      slave: !secret foxess_inv1_slave
      data_type: uint16 # bitfield - see Alarm code table
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Meter 2 Connection Code"
      unique_id: foxess_inv1_meter_2_connection_code
      address: 38901
      slave: !secret foxess_inv1_slave
      data_type: uint16 # bitfield - see Alarm code table
      state_class: measurement
      scan_interval: !secret scan_interval_low

    # -------------------------------------------------------------------------
    # PV Inputs
    #
    # Voltage = 39070 + 2 (n-1) e.g. 39070, 39072, 39074, 39076 etc
    # Current = 39071 + 2 (n-1) e.g. 39071, 39073, 39075, 39077 etc
    # Power   = 39279 + 2 (n-1) e.g. 39279, 39281, 39283, 39285 etc
    # -------------------------------------------------------------------------

    - name: "PV1 Voltage"
      unique_id: foxess_inv1_pv1_voltage
      address: 39070
      slave: !secret foxess_inv1_slave
      device_class: voltage
      unit_of_measurement: "V"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "PV1 Current"
      unique_id: foxess_inv1_pv1_current
      address: 39071
      slave: !secret foxess_inv1_slave
      device_class: current
      unit_of_measurement: "A"
      scale: 0.01
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "PV1 Power"
      unique_id: foxess_inv1_pv1_power
      address: 39279 # out of sequence
      slave: !secret foxess_inv1_slave
      data_type: int32
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high
    - name: "PV2 Voltage"
      unique_id: foxess_inv1_pv2_voltage
      address: 39072
      slave: !secret foxess_inv1_slave
      device_class: voltage
      unit_of_measurement: "V"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "PV2 Current"
      unique_id: foxess_inv1_pv2_current
      address: 39073
      slave: !secret foxess_inv1_slave
      device_class: current
      unit_of_measurement: "A"
      scale: 0.01
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "PV2 Power"
      unique_id: foxess_inv1_pv2_power
      address: 39281 # out of sequence
      slave: !secret foxess_inv1_slave
      data_type: int32
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high
    - name: "PV3 Voltage"
      unique_id: foxess_inv1_pv3_voltage
      address: 39074
      slave: !secret foxess_inv1_slave
      device_class: voltage
      unit_of_measurement: "V"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "PV3 Current"
      unique_id: foxess_inv1_pv3_current
      address: 39075
      slave: !secret foxess_inv1_slave
      device_class: current
      unit_of_measurement: "A"
      scale: 0.01
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "PV3 Power"
      unique_id: foxess_inv1_pv3_power
      address: 39283 # out of sequence
      slave: !secret foxess_inv1_slave
      data_type: int32
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high
    - name: "PV4 Voltage"
      unique_id: foxess_inv1_pv4_voltage
      address: 39076
      slave: !secret foxess_inv1_slave
      device_class: voltage
      unit_of_measurement: "V"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "PV4 Current"
      unique_id: foxess_inv1_pv4_current
      address: 39077
      slave: !secret foxess_inv1_slave
      device_class: current
      unit_of_measurement: "A"
      scale: 0.01
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "PV4 Power"
      unique_id: foxess_inv1_pv4_power
      address: 39285 # out of sequence
      slave: !secret foxess_inv1_slave
      data_type: int32
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high
      # ... etc up to 24 PV strings per inverter
    - name: "PV Power" # PV1 - PV24 combined
      unique_id: foxess_inv1_pv_power
      address: 39118
      slave: !secret foxess_inv1_slave
      data_type: int32
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high
      # Reserved uint16: 39120, 39121, 39122

    # ---------------------------------------------------------------------------
    # Note: ommitted registers 40000 - 40005
    # Inverter Year, Month, Day, Hour, Minute, Second
    # ---------------------------------------------------------------------------

    # -------------------------------------------------------------------------
    # Inverter Control registers
    # -------------------------------------------------------------------------

    - name: "Grid Standard Code"
      unique_id: foxess_inv1_grid_standard_code
      address: 40006
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "PV Config Code"
      unique_id: foxess_inv1_pv_config_code
      address: 40008
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "DRM0 State"
      unique_id: foxess_inv1_drm0_state
      address: 40009
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Meter 1 Code"
      unique_id: foxess_inv1_meter1_code
      address: 40010
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_low
      state_class: measurement
    - name: "Meter 2 Code"
      unique_id: foxess_inv1_meter2_code
      address: 40011
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Modbus Address"
      unique_id: foxess_inv1_modbus_address
      address: 40012
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Password"
      unique_id: foxess_inv1_password
      address: 40013
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_low

    - name: "Work Mode Code"
      unique_id: foxess_inv1_work_mode_code
      address: 41000
      input_type: input
      slave: !secret foxess_inv1_slave
      scan_interval: !secret scan_interval_medium
      state_class: measurement
    - name: "Time Period 1 Enabled"
      unique_id: foxess_inv1_time_period_1_enabled
      address: 41001
      slave: !secret foxess_inv1_slave
      input_type: input
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "Time Period 1 Start"
      unique_id: foxess_inv1_time_period_1_start
      address: 41002
      input_type: input
      slave: !secret foxess_inv1_slave
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "Time Period 1 End"
      unique_id: foxess_inv1_time_period_1_end
      address: 41003
      input_type: input
      slave: !secret foxess_inv1_slave
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "Time Period 2 Enabled"
      unique_id: foxess_inv1_time_period_2_enabled
      address: 41004
      slave: !secret foxess_inv1_slave
      input_type: input
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "Time Period 2 Start"
      unique_id: foxess_inv1_time_period_2_start
      address: 41005
      input_type: input
      slave: !secret foxess_inv1_slave
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "Time Period 2 End"
      unique_id: foxess_inv1_time_period_2_end
      address: 41006
      input_type: input
      slave: !secret foxess_inv1_slave
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "Max Charge Current"
      unique_id: foxess_inv1_max_charge_current
      address: 41007
      input_type: input
      slave: !secret foxess_inv1_slave
      device_class: current
      unit_of_measurement: "A"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "Max Discharge Current"
      unique_id: foxess_inv1_max_discharge_current
      address: 41008
      input_type: input
      slave: !secret foxess_inv1_slave
      device_class: current
      unit_of_measurement: "A"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Min SoC"
      unique_id: foxess_inv1_min_soc
      address: 41009
      input_type: input
      slave: !secret foxess_inv1_slave
      device_class: battery
      unit_of_measurement: "%"
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Max SoC"
      unique_id: foxess_inv1_max_soc
      address: 41010
      input_type: input
      slave: !secret foxess_inv1_slave
      device_class: battery
      unit_of_measurement: "%"
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Min SoC On Grid"
      unique_id: foxess_inv1_min_soc_on_grid
      address: 41011
      input_type: input
      slave: !secret foxess_inv1_slave
      device_class: battery
      unit_of_measurement: "%"
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Export Limit"
      unique_id: foxess_inv1_export_limit
      address: 41012
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "System Enable"
      unique_id: foxess_inv1_system_enable
      address: 41013
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "EPS Frequency Code"
      unique_id: foxess_inv1_eps_frequency_code
      address: 41014
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "EPS Enable Code"
      unique_id: foxess_inv1_eps_enable_code
      address: 41015
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_low

    # ---------------------------------------------------------------------------
    # Remote Control registers: 44000 - 44013
    # ---------------------------------------------------------------------------
    - name: "Remote Control Code"
      unique_id: foxess_inv1_remote_control_code
      address: 44000
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Remote Timeout Set"
      unique_id: foxess_inv1_remote_timeout_set
      address: 44001
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Remote Control Active Power Command"
      unique_id: foxess_inv1_remote_control_active_power_command
      address: 44002
      input_type: input
      slave: !secret foxess_inv1_slave
      device_class: power
      unit_of_measurement: "W"
      scale: 1
      precision: 0
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Remote Control Reactive Power Command"
      unique_id: foxess_inv1_remote_control_reactive_power_command
      address: 44003
      input_type: input
      slave: !secret foxess_inv1_slave
      device_class: power
      unit_of_measurement: "VAR"
      scale: 1
      precision: 0
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Remote Timeout Countdown"
      unique_id: foxess_inv1_remote_timeout_countdown
      address: 44004
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Remote Take Effect"
      unique_id: foxess_inv1_take_effect
      address: 44005
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Remote Not Active Reason Code"
      unique_id: foxess_inv1_remote_not_active_reason_code
      address: 44006
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Remote Pwr_Limit Bat_Up"
      unique_id: foxess_inv1_remote_pwr_limit_bat_up
      address: 44012
      input_type: input
      slave: !secret foxess_inv1_slave
      device_class: power
      unit_of_measurement: "W"
      scale: 1
      precision: 0
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Remote Pwr_Limit Bat_Dn"
      unique_id: foxess_inv1_remote_pwr_limit_bat_dn
      address: 44013
      input_type: input
      slave: !secret foxess_inv1_slave
      device_class: power
      unit_of_measurement: "W"
      scale: 1
      precision: 0
      state_class: measurement
      scan_interval: !secret scan_interval_low

    # ---------------------------------------------------------------------------
    # Charge Control
    # ---------------------------------------------------------------------------
    - name: "Import Power Limit"
      unique_id: foxess_inv1_import_power_limit
      address: 46501 # R/W
      slave: !secret foxess_inv1_slave
      data_type: int32
      device_class: power
      unit_of_measurement: "W"
      scale: 1
      precision: 0
      state_class: measurement
      scan_interval: !secret scan_interval_medium

  # ---------------------------------------------------------------------------
  # END: modbus include file for HA-FoxESS-Modbus RS485 connection
  # ---------------------------------------------------------------------------
